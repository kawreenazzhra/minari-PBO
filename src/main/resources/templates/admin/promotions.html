<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{layouts/admin}">

<head>
    <title>Promotions</title>
</head>

<body>
    <div layout:fragment="content">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2 class="page-title">Promotions</h2>
            <a th:href="@{/admin/promotions/add}" class="btn-add" style="text-decoration: none;">
                <i class="fas fa-plus"></i> Add New Promotion
            </a>
        </div>

        <div class="table-custom">
            <table class="table mb-0">
                <thead>
                    <tr>
                        <th>Promo Code</th>
                        <th>Description</th>
                        <th>Discount</th>
                        <th>Start Date</th>
                        <th>End Date</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="promo : ${promotions}">
                        <td><strong th:text="${promo.promoCode}">CODE</strong></td>
                        <td th:text="${promo.description}">Desc</td>
                        <td>
                            <span th:if="${promo.discountType.name() == 'PERCENTAGE'}"
                                th:text="${#numbers.formatDecimal(promo.discountValue, 1, 0) + '%'}">10%</span>
                            <span th:if="${promo.discountType.name() == 'FIXED_AMOUNT'}"
                                th:text="'Rp ' + ${#numbers.formatDecimal(promo.discountValue, 0, 'COMMA', 0, 'POINT')}">Rp
                                10.000</span>
                            <span
                                th:if="${promo.discountType.name() != 'PERCENTAGE' and promo.discountType.name() != 'FIXED_AMOUNT'}"
                                th:text="${promo.discountType}">Type</span>
                        </td>
                        <td th:text="${#temporals.format(promo.startDate, 'dd MMM yyyy')}">01 Jan 2025</td>
                        <td th:text="${#temporals.format(promo.endDate, 'dd MMM yyyy')}">31 Jan 2025</td>
                        <td>
                            <span th:text="${promo.isActive ? 'Active' : 'Inactive'}"
                                th:class="${promo.isActive ? 'badge-status badge-active' : 'badge-status badge-inactive'}">
                                Active
                            </span>
                        </td>
                        <td class="action-icons">
                            <a th:href="@{/admin/promotions/{id}/edit(id=${promo.id})}" class="btn-icon btn-edit me-2">
                                <i class="fas fa-edit"></i>
                            </a>
                            <button type="button" class="btn btn-link p-0 text-danger"
                                th:attr="data-id=${promo.id},data-code=${promo.promoCode}"
                                onclick="confirmDelete(this.getAttribute('data-id'), this.getAttribute('data-code'))">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                    <tr th:if="${promotions == null or promotions.empty}">
                        <td colspan="7" class="text-center py-4">No promotions found.</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <form id="deleteForm" method="POST" class="d-none">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
        </form>

        <script>
            function confirmDelete(id, code) {
                if (confirm('Delete promotion ' + code + '?')) {
                    let form = document.getElementById('deleteForm');
                    form.action = '/admin/promotions/' + id + '/delete';
                    form.submit();
                }
            }
        </script>
    </div>
</body>

</html>