<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{layouts/admin}">

<head>
    <title>Add New Promotion</title>
</head>

<body>
    <div layout:fragment="content">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2 class="page-title">Add New Promotion</h2>
            <a th:href="@{/admin/promotions}" class="btn-cancel">
                <i class="fas fa-arrow-left"></i> Back to Promotions
            </a>
        </div>

        <div th:if="${error}" class="alert alert-danger">
            <span th:text="${error}">Error</span>
        </div>

        <div class="form-container">
            <form id="promotionForm" th:action="@{/admin/promotions}" method="POST">
                <!-- CSRF Token -->
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

                <!-- Hidden name field (mirrors promo code) -->
                <input type="hidden" name="name" id="promoName">

                <div class="row">
                    <!-- Left Column -->
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="form-label">Promo Code <span class="text-danger">*</span></label>
                            <div class="input-group">
                                <input type="text" name="code" id="promoCode" class="form-control"
                                    placeholder="Enter promo code" required>
                                <button type="button" class="btn btn-secondary" id="generateBtn"
                                    onclick="generatePromoCode()">
                                    Generate
                                </button>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Discount Value <span class="text-danger">*</span></label>
                            <input type="number" name="discountValue" id="discountValue" class="form-control"
                                placeholder="Enter discount value" step="0.01" min="0" required>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Minimum Purchase</label>
                            <input type="number" name="minPurchaseAmount" class="form-control"
                                placeholder="Enter minimum purchase amount" step="0.01" min="0">
                        </div>

                        <div class="form-group">
                            <label class="form-label">Usage Limit</label>
                            <input type="number" name="usageLimit" id="usageLimit" class="form-control"
                                placeholder="Enter usage limit" min="1">
                        </div>
                    </div>

                    <!-- Right Column -->
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="form-label">Discount Type <span class="text-danger">*</span></label>
                            <select name="discountType" id="discountType" class="form-select" required>
                                <option value="">Select discount type</option>
                                <option value="PERCENTAGE">Percentage</option>
                                <option value="FIXED_AMOUNT">Fixed Amount</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Description <span class="text-danger">*</span></label>
                            <textarea name="description" class="form-control" rows="4"
                                placeholder="Enter promotion description" required></textarea>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Status <span class="text-danger">*</span></label>
                            <select name="isActive" class="form-select" required>
                                <option value="true" selected>Active</option>
                                <option value="false">Inactive</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Date Range Row -->
                <div class="row mt-3">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="form-label">Start Date <span class="text-danger">*</span></label>
                            <input type="date" name="startDate" id="startDate" class="form-control" required>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="form-label">End Date <span class="text-danger">*</span></label>
                            <input type="date" name="endDate" id="endDate" class="form-control" required>
                        </div>
                    </div>
                </div>

                <!-- Applicable Products Section -->
                <div class="row mt-4">
                    <div class="col-12">
                        <div class="form-group">
                            <label class="form-label">Applicable Products</label>
                            <div class="products-selection"
                                style="max-height: 300px; overflow-y: auto; border: 1px solid #ddd; border-radius: 8px; padding: 15px; background: #f9f9f9;">
                                <div class="form-check mb-3"
                                    style="border-bottom: 1px solid #ddd; padding-bottom: 10px;">
                                    <input class="form-check-input" type="checkbox" id="selectAllProducts"
                                        onchange="toggleAllProducts(this)">
                                    <label class="form-check-label fw-bold" for="selectAllProducts">
                                        All Products
                                    </label>
                                </div>
                                <div th:each="product : ${products}" class="form-check">
                                    <input class="form-check-input product-checkbox" type="checkbox" name="productIds"
                                        th:value="${product.id}" th:id="'product-' + ${product.id}">
                                    <label class="form-check-label" th:for="'product-' + ${product.id}"
                                        th:text="${product.name}">
                                        Product Name
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="row mt-4">
                    <div class="col-12">
                        <div class="d-flex gap-3 justify-content-end">
                            <button type="button" class="btn-cancel" onclick="window.location.href='/admin/promotions'">
                                Cancel
                            </button>
                            <button type="submit" class="btn-submit">
                                <i class="fas fa-plus"></i> Add Promotion
                            </button>
                        </div>
                    </div>
                </div>
            </form>
        </div>

        <script th:src="@{/js/addpromotionadmin.js}"></script>
    </div>
</body>

</html>