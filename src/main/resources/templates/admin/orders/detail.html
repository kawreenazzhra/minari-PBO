<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{layouts/admin}">

<head>
    <title>Order Details</title>
    <style>
        .detail-card {
            background: #fff;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.02);
            height: 100%;
            border: 1px solid #f0f0f0;
        }

        .section-title {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 20px;
            color: #1a1a1a;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            font-size: 14px;
        }

        .info-label {
            color: #6c757d;
        }

        .info-value {
            font-weight: 500;
            color: #1a1a1a;
            text-align: right;
        }

        .badge-status {
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
        }

        .badge-paid {
            background-color: #d1fae5;
            color: #065f46;
        }

        .badge-pending {
            background-color: #fef3c7;
            color: #d97706;
        }

        .badge-shipped {
            background-color: #dbeafe;
            color: #1e40af;
        }

        .badge-delivered {
            background-color: #dcfce7;
            color: #166534;
        }

        .product-item {
            display: flex;
            align-items: center;
            padding: 16px 0;
            border-bottom: 1px solid #f9fafb;
        }

        .product-item:last-child {
            border-bottom: none;
        }

        .product-img {
            width: 64px;
            height: 64px;
            object-fit: cover;
            border-radius: 8px;
            background: #f3f4f6;
            margin-right: 16px;
        }

        .product-details {
            flex-grow: 1;
        }

        .product-name {
            font-weight: 600;
            color: #111827;
            margin-bottom: 4px;
        }

        .product-variant {
            font-size: 13px;
            color: #6b7280;
            margin-bottom: 2px;
        }

        .product-qty {
            font-size: 13px;
            color: #6b7280;
        }

        .product-price {
            font-weight: 600;
            color: #111827;
        }

        .status-select {
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 10px;
            width: 100%;
            background-color: white;
            margin-top: 5px;
        }

        .btn-update {
            background-color: #1f2937;
            color: white;
            border-radius: 8px;
            padding: 10px;
            width: 100%;
            border: none;
            font-weight: 500;
            margin-top: 15px;
        }

        .btn-update:hover {
            background-color: #111827;
        }

        .form-label-custom {
            font-size: 13px;
            font-weight: 600;
            color: #374151;
            margin-bottom: 4px;
            display: block;
        }

        @media print {
            @page {
                margin: 1cm;
                size: A4;
            }

            body {
                background: #fff !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }

            /* Hide Web Elements */
            .no-print,
            nav,
            header,
            .sidebar,
            .btn,
            .badge-status,
            .status-select,
            .form-control,
            footer {
                display: none !important;
            }

            /* Layout Resets */
            .container-fluid,
            .row,
            .col-md-6,
            .col-12 {
                padding: 0 !important;
                margin: 0 !important;
            }

            /* Grid Layout for Print - STRICT ENFORCEMENT */
            .row {
                display: grid !important;
                grid-template-columns: repeat(12, 1fr) !important;
                gap: 20px !important;
                width: 100% !important;
                margin: 0 !important;
            }

            .col-md-6 {
                grid-column: span 6 !important;
                width: 100% !important;
                max-width: 100% !important;
            }

            .col-12 {
                grid-column: span 12 !important;
            }

            /* Specific fix for the top info section to ensure side-by-side */
            .row.g-4 {
                display: grid !important;
                grid-template-columns: 1fr 1fr !important;
                gap: 20px !important;
            }

            .row.g-4>.col-md-6 {
                grid-column: auto !important;
                /* Let them flow naturally into the 2 columns */
                width: auto !important;
            }

            /* Allow full width for bottom section payment summary if needed, or keep 2 cols */
            /* For now, keeping consistent 2-col grid */
            /* Invoice Header */
            .invoice-header {
                display: block !important;
                margin-bottom: 30px;
                border-bottom: 2px solid #000;
                padding-bottom: 10px;
                width: 100%;
            }

            .invoice-title {
                font-size: 24px;
                font-weight: 800;
                text-transform: uppercase;
                letter-spacing: 1px;
                margin-bottom: 5px;
            }

            .invoice-subtitle {
                font-size: 14px;
                color: #333;
                margin-bottom: 20px;
            }

            .invoice-meta {
                text-align: right;
                font-size: 14px;
            }
        }

        .invoice-header {
            display: none;
        }
    </style>
</head>

<body>
    <div layout:fragment="content">
        <!-- Print Only Header -->
        <div class="invoice-header">
            <div
                style="display: grid !important; grid-template-columns: 1fr 1fr !important; width: 100% !important; align-items: end;">
                <div>
                    <div class="invoice-title">MINARI</div>
                    <div class="invoice-subtitle">Official Invoice & Receipt</div>
                </div>
                <div class="invoice-meta">
                    <div>Date: <span th:text="${#temporals.format(order.orderDate, 'dd MMM yyyy')}">26 Dec 2025</span>
                    </div>
                    <div>Order #: <span th:text="${order.orderNumber}">MIN2025...</span></div>
                </div>
            </div>
        </div>
        <!-- Header -->
        <div class="mb-5 no-print">
            <div class="d-flex align-items-center mb-2">
                <a th:href="@{/admin/orders}" class="btn btn-light btn-sm me-3 border no-print"
                    style="padding: 6px 12px; background: #fff;">
                    <i class="fas fa-arrow-left me-1"></i> Back to Orders
                </a>
            </div>
            <div class="d-flex align-items-center gap-3 flex-wrap">
                <h2 class="m-0 fw-bold" th:text="'Order #' + ${order.orderNumber}">Order #MIN20251225505581</h2>

                <span th:class="'badge-status badge-' + ${#strings.toLowerCase(order.paymentStatus)}"
                    th:text="${#strings.capitalize(#strings.toLowerCase(order.paymentStatus))}">Paid</span>

                <span th:class="'badge-status badge-' + ${#strings.toLowerCase(order.status)}"
                    th:text="${#strings.capitalize(#strings.toLowerCase(order.status))}">Pending</span>

                <span class="text-muted small fw-medium"
                    th:text="${#temporals.format(order.orderDate, 'dd.MM.yyyy HH:mm')}">25.12.2025 19:17</span>
            </div>
        </div>

        <!-- Top Grid: Customer & Address -->
        <div class="row g-4 mb-4">
            <div class="col-md-6">
                <div class="detail-card">
                    <h5 class="section-title">Customer Information</h5>
                    <div class="info-row">
                        <span class="info-label">Customer</span>
                        <span class="info-value" th:text="${order.customerName}">Linlin</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Email</span>
                        <span class="info-value" th:text="${order.customerEmail}">linlin@minari.com</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Phone</span>
                        <span class="info-value" th:text="${order.customerPhone}">081234567890</span>
                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <div class="detail-card">
                    <h5 class="section-title">Shipping Address</h5>
                    <div class="text-end" style="color: #1a1a1a; font-size: 14px; line-height: 1.6;">
                        <div th:text="${order.shippingAddressStreet}">Jalan Cempaka No.3, Lembang</div>
                        <div th:text="${order.shippingAddressCity} + ' ' + ${order.shippingAddressPostalCode}">Bandung
                            4567</div>
                        <div th:text="${order.shippingAddressState != null ? order.shippingAddressState : ''}">West Java
                        </div>
                        <div th:text="${order.shippingAddressCountry}">Indonesia</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Order Items -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="detail-card">
                    <h5 class="section-title">Order Items</h5>
                    <div class="products-list">
                        <div th:each="item : ${order.items}" class="product-item">
                            <img th:src="${item.imageUrl != null ? item.imageUrl : '/images/placeholder.jpg'}"
                                alt="Product" class="product-img">
                            <div class="product-details">
                                <div class="product-name" th:text="${item.productName}">Cherry white fleece jacket</div>
                                <div class="product-variant" th:if="${item.variantInfo != null}"
                                    th:text="${item.variantInfo}">Size: N/A | Color: N/A</div>
                                <div class="product-qty" th:text="'Qty: ' + ${item.quantity}">Qty: 1</div>
                            </div>
                            <div class="product-price"
                                th:text="'Rp ' + ${#numbers.formatDecimal(item.unitPrice, 0, 'POINT', 0, 'POINT')}">Rp
                                250.000</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bottom Grid: Delivery & Payment -->
        <div class="row g-4">
            <div class="col-md-6">
                <div class="detail-card">
                    <h5 class="section-title">Delivery Information</h5>

                    <div class="info-row">
                        <span class="info-label">Tracking Number</span>
                        <span class="info-value"
                            th:text="${order.trackingNumber != null ? order.trackingNumber : '-'}">-</span>
                    </div>
                    <!-- Note: Check DTO field for shipping cost. Original file used shippingCost -->
                    <div class="info-row">
                        <span class="info-label">Shipping Cost</span>
                        <span class="info-value"
                            th:text="'Rp ' + ${#numbers.formatDecimal(order.shippingCost, 0, 'POINT', 0, 'POINT')}">Rp
                            15.000</span>
                    </div>

                    <div class="mt-4 pt-3 border-top no-print"
                        th:if="${#strings.equalsIgnoreCase(order.paymentStatus, 'paid') or #strings.equalsIgnoreCase(order.paymentMethod, 'COD')}">
                        <h6 class="section-title mb-3" style="font-size: 14px;">Update Status</h6>
                        <form th:action="@{/admin/orders/{id}/status(id=${order.id})}" method="POST">
                            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

                            <div class="mb-3">
                                <label class="form-label-custom">Order Status</label>
                                <select name="status" class="status-select">
                                    <option value="PENDING" th:selected="${order.status == 'PENDING'}">Pending</option>
                                    <option value="PROCESSING" th:selected="${order.status == 'PROCESSING'}">Processing
                                    </option>
                                    <option value="SHIPPED" th:selected="${order.status == 'SHIPPED'}">Shipped</option>
                                    <option value="DELIVERED" th:selected="${order.status == 'DELIVERED'}">Delivered
                                    </option>
                                    <option value="CANCELLED" th:selected="${order.status == 'CANCELLED'}">Cancelled
                                    </option>
                                </select>
                            </div>
                            <!-- Show payment status update if needed, but usually derived -->

                            <div class="mb-3">
                                <label class="form-label-custom">Tracking Number (Required for Shipped)</label>
                                <input type="text" name="trackingNumber" class="status-select"
                                    th:value="${order.trackingNumber}" placeholder="Enter tracking number">
                            </div>

                            <button type="submit" class="btn-update">Update Status</button>
                        </form>
                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <div class="detail-card">
                    <h5 class="section-title">Payment Summary</h5>
                    <div class="info-row">
                        <span class="info-label">Subtotal</span>
                        <span class="info-value"
                            th:text="'Rp ' + ${#numbers.formatDecimal(order.subtotalAmount, 0, 'POINT', 0, 'POINT')}">Rp
                            250.000</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Delivery</span>
                        <span class="info-value"
                            th:text="'Rp ' + ${#numbers.formatDecimal(order.shippingCost, 0, 'POINT', 0, 'POINT')}">Rp
                            15.000</span>
                    </div>
                    <div class="info-row mt-3 pt-3 border-top">
                        <span class="info-label fw-bold text-dark">Grand Total</span>
                        <span class="info-value fw-bold fs-5"
                            th:text="'Rp ' + ${#numbers.formatDecimal(order.totalAmount, 0, 'POINT', 0, 'POINT')}">Rp
                            265.000</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="mt-4 text-end no-print">
            <button onclick="window.print()" class="btn btn-outline-secondary">
                <i class="fas fa-print me-2"></i> Print Invoice
            </button>
        </div>
    </div>
</body>

</html>