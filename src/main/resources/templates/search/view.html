<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{layouts/main}">

<head>
    <title th:text="'Search: ' + ${query} + ' - MINARI'">Search Results - MINARI</title>
    <!-- Add CSRF token just in case -->
    <meta name="csrf-token" th:content="${_csrf.token}" />

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- CSS -->
    <link rel="stylesheet" th:href="@{/css/category.css}">
    <!-- Navbar CSS handled by layout -->
</head>

<body>
    <div layout:fragment="content">
        <!-- Hero -->
        <section class="hero"
            th:style="'min-height: 150px; display: flex; align-items: center; justify-content: center; background-image: url(' + @{/images/aesthetic_search_bg.png} + '); background-size: cover; background-position: center; padding: 0 5%; text-align: center;'">
            <div id="heroTitle"
                style="color: #5a4b45; font-size: 28px; font-weight: 700; font-family: 'Playfair Display', serif; text-shadow: 2px 2px 4px rgba(255, 255, 255, 0.8);">
                Search Results: "<span th:text="${query}"></span>"
            </div>
        </section>

        <!-- Grid produk -->
        <main class="container-fluid p-0">
            <div id="productGrid" class="row g-0">
                <th:block th:if="${products != null and !products.empty}">
                    <div class="col-6 col-md-4 col-lg-3" th:each="product : ${products}"
                        th:data-product-id="${product.id}">
                        <a th:href="@{'/products/' + ${product.id}}" class="p-card-link">
                            <article class="p-card">
                                <!-- Discount Badge Logic if applicable -->
                                <!-- 
                                <div class="discount-badge" th:if="${product.discountPrice}">
                                    -<span th:text="${#numbers.formatInteger(((product.price - product.discountPrice) / product.price) * 100, 0)}"></span>%
                                </div>
                                -->

                                <div class="p-thumb">
                                    <!-- Assume imageUrl is absolute or relative path -->
                                    <img th:src="@{${product.imageUrl != null ? product.imageUrl : '/images/default-product.jpg'}}"
                                        th:alt="${product.name}" loading="lazy"
                                        onerror="this.src='/images/default-product.jpg'">
                                </div>
                                <div class="p-info">
                                    <div class="p-info-row">
                                        <div class="p-text">
                                            <h6 class="p-name" th:text="${product.name}">Product Name</h6>
                                            <div class="p-meta">
                                                <div class="p-price">
                                                    <!-- Price formatting -->
                                                    <span class="current-price"
                                                        th:text="'Rp ' + ${#numbers.formatDecimal(product.price, 0, 'POINT', 0, 'COMMA')}">Rp
                                                        0</span>
                                                </div>
                                                <!-- Rating if available -->
                                                <!-- 
                                                <div class="product-rating" th:if="${product.averageRating > 0}">
                                                    <i class="fas fa-star"></i> <span th:text="${#numbers.formatDecimal(product.averageRating, 1, 'POINT', 1, 'COMMA')}">4.5</span>
                                                </div>
                                                -->
                                            </div>
                                            <small class="out-of-stock-text" th:if="${product.stockQuantity <= 0}">
                                                <i class="fas fa-times-circle"></i> Out of Stock
                                            </small>
                                        </div>
                                        <div class="p-mini-actions">
                                            <!-- Wishlist logic implemented in wishlist.js/cart.js -->
                                            <button class="p-wish" aria-label="Wishlist"
                                                th:onclick="'event.preventDefault(); addToWishlist(' + ${product.id} + ', this)'">
                                                <i class="far fa-heart"></i>
                                            </button>
                                            <button class="p-cart" aria-label="Add to cart"
                                                th:onclick="'event.preventDefault(); window.addToCart(' + ${product.id} + ')'">
                                                <i class="fas fa-shopping-cart"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </article>
                        </a>
                    </div>
                </th:block>

                <div class="col-12" th:if="${products == null or products.empty}">
                    <div class="product-empty-state text-center py-5">
                        <i class="fas fa-box-open fs-1 text-muted mb-3"></i>
                        <h3>No Products Found</h3>
                        <p>There are no products available matching your search.</p>
                        <a th:href="@{/}" class="btn btn-primary mt-3 back-home-btn">
                            <i class="fas fa-arrow-left"></i> Back to Home
                        </a>
                    </div>
                </div>
            </div>
        </main>

        <!-- Toast -->
        <div class="toast-container position-fixed bottom-0 end-0 p-3">
            <div id="miniToast" class="toast align-items-center" data-bs-delay="1600" role="status" aria-live="polite">
                <div class="d-flex">
                    <div class="toast-body" id="toastMessage">Item has been added to your cart.</div>
                    <button type="button" class="btn-close me-2 m-auto" data-bs-dismiss="toast"
                        aria-label="Close"></button>
                </div>
            </div>
        </div>

        <!-- Scripts -->
        <script th:src="@{/js/cart.js}"></script>
        <script th:src="@{/js/category.js}"></script>
        <!-- Inline script to init if needed -->
    </div>
</body>

</html>