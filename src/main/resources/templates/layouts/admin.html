<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MINARI - Admin</title>
    <!-- Note: Original had @yield('title'), can be done with layout:title-pattern or simple th:text in fragment, but hardcoding Layout title for simplicity or using a block -->

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link
        href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Poppins:wght@400;500;600&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" th:href="@{/css/style1.css}">
</head>

<body>
    <!-- Navbar -->
    <nav class="navbar-custom fixed-top">
        <div class="container-fluid">
            <div class="d-flex justify-content-between align-items-center w-100 px-5">
                <div class="logo">
                    <a th:href="@{/admin/dashboard}">
                        <img th:src="@{/images/logofix.png}" alt="Logo MINARI" style="height: 35px; width: auto;">
                    </a>
                </div>

                <div class="navbar-icons d-flex align-items-center gap-3">
                    <!-- Search Bar (Simplified Logic for MVP) -->
                    <!-- We default to product search as generic fallback -->
                    <form class="d-flex align-items-center" role="search" th:action="@{/admin/products}" method="GET">
                        <div class="input-group input-group-sm" style="width: 220px;">
                            <span class="input-group-text bg-white border-end-0"
                                style="border-radius: 20px 0 0 20px; border-color: #eee; padding-left: 12px;">
                                <img th:src="@{/images/searchnav.png}" width="16" height="16">
                            </span>
                            <input class="form-control border-start-0 ps-2 text-muted" type="search" name="keyword"
                                placeholder="Search..." aria-label="Search"
                                style="border-radius: 0 20px 20px 0; border-color: #eee; font-size: 13px; height: 32px;"
                                th:value="${keyword}">
                        </div>
                    </form>

                    <!-- Notifications Dropdown (Static for now as backend doesn't provide global notification data yet) -->
                    <div class="dropdown d-flex align-items-center">
                        <a href="#" class="nav-icon d-flex align-items-center justify-content-center position-relative"
                            id="notificationDropdown" data-bs-toggle="dropdown" aria-expanded="false"
                            title="Notifications" style="width: 32px; height: 32px;">
                            <img th:src="@{/images/notification.png}" alt="Notifications" width="20" height="20">
                            <!-- Badge would go here if data available -->
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end shadow border-0"
                            aria-labelledby="notificationDropdown"
                            style="min-width: 320px; border-radius: 12px; max-height: 400px; overflow-y: auto;">
                            <li>
                                <div class="d-flex justify-content-between align-items-center px-3 py-2">
                                    <h6 class="dropdown-header font-weight-bold mb-0 p-0 text-dark">Notifications</h6>
                                </div>
                            </li>
                            <li>
                                <hr class="dropdown-divider m-0">
                            </li>
                            <li class="text-center py-4">
                                <i class="far fa-bell-slash text-muted mb-2 fa-lg"></i>
                                <p class="text-muted small mb-0">No new notifications</p>
                            </li>
                        </ul>
                    </div>

                    <!-- Suggestions / Email -->
                    <a href="#" class="nav-icon d-flex align-items-center justify-content-center"
                        title="Customer Suggestions" style="width: 32px; height: 32px;">
                        <img th:src="@{/images/email.png}" alt="Messages" width="20" height="20">
                    </a>

                    <!-- Logout -->
                    <form th:action="@{/logout}" method="POST" class="d-inline mb-0 d-flex align-items-center">
                        <input type="hidden" th:if="${_csrf}" th:name="${_csrf.parameterName}"
                            th:value="${_csrf.token}" />
                        <button type="submit"
                            class="btn btn-link p-0 nav-icon d-flex align-items-center justify-content-center text-dark"
                            title="Logout" style="width: 32px; height: 32px;">
                            <i class="fas fa-sign-out-alt" style="font-size: 20px; color: #333;"></i>
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </nav>

    <div class="sidebar">
        <a th:href="@{/admin/dashboard}" class="sidebar-item"
            th:classappend="${currentUri == '/admin/dashboard'} ? 'active' : ''">
            <i class="fas fa-table-columns"></i>
            <span>Dashboard</span>
        </a>
        <a th:href="@{/admin/products}" class="sidebar-item"
            th:classappend="${currentUri != null and currentUri.startsWith('/admin/products')} ? 'active' : ''">
            <i class="fas fa-box"></i>
            <span>Products</span>
        </a>
        <a th:href="@{/admin/categories}" class="sidebar-item"
            th:classappend="${currentUri != null and currentUri.startsWith('/admin/categories')} ? 'active' : ''">
            <i class="fas fa-layer-group"></i>
            <span>Categories</span>
        </a>
        <a th:href="@{/admin/orders}" class="sidebar-item"
            th:classappend="${currentUri != null and currentUri.startsWith('/admin/orders')} ? 'active' : ''">
            <i class="fas fa-file-invoice"></i>
            <span>Orders</span>
        </a>
        <a th:href="@{/admin/reviews}" class="sidebar-item"
            th:classappend="${currentUri != null and currentUri.startsWith('/admin/reviews')} ? 'active' : ''">
            <i class="fas fa-thumbs-up"></i>
            <span>Reviews</span>
        </a>
        <a th:href="@{/admin/promotions}" class="sidebar-item"
            th:classappend="${currentUri != null and currentUri.startsWith('/admin/promotions')} ? 'active' : ''">
            <i class="fas fa-ad"></i>
            <span>Promotions</span>
        </a>
    </div>

    <div class="main-content">
        <!-- Toast Notifications (Flash Attributes) -->
        <div th:if="${success}" class="toast-notification success show">
            <i class="fas fa-check-circle"></i>
            <span th:text="${success}">Success</span>
        </div>
        <div th:if="${error}" class="toast-notification error show">
            <i class="fas fa-exclamation-circle"></i>
            <span th:text="${error}">Error</span>
        </div>
        <script>
            document.addEventListener('DOMContentLoaded', function () {
                const toasts = document.querySelectorAll('.toast-notification');
                toasts.forEach(toast => {
                    setTimeout(() => { toast.classList.remove('show'); setTimeout(() => toast.remove(), 300); }, 3000);
                });
            });
        </script>
        <style>
            .toast-notification {
                position: fixed;
                top: 90px;
                right: 20px;
                z-index: 99999;
                background: white;
                padding: 12px 20px;
                border-radius: 10px;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
                display: flex;
                align-items: center;
                gap: 10px;
                transition: transform 0.4s;
                font-size: 14px;
                font-weight: 500;
                max-width: 350px;
            }

            .toast-notification.show {
                transform: translateX(0);
            }

            .toast-notification.success {
                border-left: 4px solid #198754;
                color: #0f5132;
            }

            .toast-notification.error {
                border-left: 4px solid #dc3545;
                color: #842029;
            }
        </style>

        <div layout:fragment="content">
            <!-- Content goes here -->
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script th:src="@{/js/navigation.js}"></script>
    <script th:src="@{/js/admin-navbar.js}"></script>
</body>

</html>