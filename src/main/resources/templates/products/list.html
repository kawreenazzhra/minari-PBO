<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{layouts/main}">

<head>
    <title th:text="${selectedCategory != null ? selectedCategory + ' - MINARI' : 'Products - MINARI'}">Products -
        MINARI
    </title>
    <meta name="csrf-token" th:content="${_csrf.token}" />

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- CSS -->
    <link rel="stylesheet" th:href="@{/css/category.css}">
</head>

<body>
    <div layout:fragment="content">
        <!-- Hero -->
        <section class="hero"
            th:style="'min-height: 450px; display: flex; align-items: center; justify-content: center; background-image: url(' + @{${categoryObj != null and categoryObj.bannerUrl != null ? categoryObj.bannerUrl : '/images/aesthetic_search_bg.png'}} + '); background-size: cover; background-position: center; padding: 0 5%; text-align: center;'">
            <div id="heroTitle"
                style="color: #E9967A; font-size: 72px; font-weight: 800; font-family: 'Playfair Display', serif; text-shadow: 2px 2px 10px rgba(0, 0, 0, 0.15);">
                <span th:text="${selectedCategory != null ? selectedCategory : 'All Products'}">All Products</span>
            </div>
        </section>

        <!-- Grid produk -->
        <main class="container-fluid p-0">
            <div id="productGrid" class="row g-0">
                <th:block th:if="${products != null and !products.empty}">
                    <div class="col-6 col-md-4 col-lg-3" th:each="product : ${products}"
                        th:data-product-id="${product.id}">
                        <a th:href="@{'/products/' + ${product.id}}" class="p-card-link">
                            <article class="p-card">
                                <div class="p-thumb">
                                    <img th:src="@{${product.imageUrl != null ? product.imageUrl : '/images/default-product.jpg'}}"
                                        th:alt="${product.name}" loading="lazy"
                                        onerror="this.src='/images/default-product.jpg'">
                                </div>
                                <div class="p-info">
                                    <div class="p-info-row">
                                        <div class="p-text">
                                            <h6 class="p-name" th:text="${product.name}">Product Name</h6>
                                            <div class="p-meta">
                                                <div
                                                    class="p-price d-flex align-items-center justify-content-between w-100">
                                                    <span class="current-price"
                                                        th:text="'Rp ' + ${#numbers.formatDecimal(product.price, 0, 'POINT', 0, 'COMMA')}">Rp
                                                        0</span>
                                                    <span class="product-rating small"
                                                        th:if="${product.averageRating > 0}">
                                                        <i class="fas fa-star text-warning"></i>
                                                        <span th:text="${product.averageRating}"
                                                            class="text-dark fw-semibold ms-1">4.5</span>
                                                    </span>
                                                </div>
                                            </div>
                                            <small class="out-of-stock-text" th:if="${product.stockQuantity <= 0}">
                                                <i class="fas fa-times-circle"></i> Out of Stock
                                            </small>
                                        </div>
                                        <div class="p-mini-actions">
                                            <button class="p-wish" aria-label="Wishlist"
                                                th:onclick="'event.preventDefault(); addToWishlist(' + ${product.id} + ', this)'">
                                                <i class="far fa-heart"></i>
                                            </button>
                                            <button class="p-cart" aria-label="Add to cart"
                                                th:onclick="'event.preventDefault(); window.addToCart(' + ${product.id} + ')'">
                                                <i class="fas fa-shopping-cart"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </article>
                        </a>
                    </div>
                </th:block>

                <div class="col-12" th:if="${products == null or products.empty}">
                    <div class="product-empty-state text-center py-5">
                        <i class="fas fa-box-open fs-1 text-muted mb-3"></i>
                        <h3>No Products Found</h3>
                        <p>There are no products available in this category.</p>
                        <a th:href="@{/}" class="btn btn-primary mt-3 back-home-btn">
                            <i class="fas fa-arrow-left"></i> Back to Home
                        </a>
                    </div>
                </div>
            </div>
        </main>

        <!-- Toast -->
        <div class="toast-container position-fixed bottom-0 end-0 p-3">
            <div id="miniToast" class="toast align-items-center" data-bs-delay="1600" role="status" aria-live="polite">
                <div class="d-flex">
                    <div class="toast-body" id="toastMessage">Item has been added to your cart.</div>
                    <button type="button" class="btn-close me-2 m-auto" data-bs-dismiss="toast"
                        aria-label="Close"></button>
                </div>
            </div>
        </div>

        <!-- Login Modal -->
        <div class="modal fade" id="loginModal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content" style="border-radius: 12px; border: none;">
                    <div class="modal-header border-0 justify-content-center pt-4">
                        <h5 class="modal-title fw-bold">Please Log In</h5>
                    </div>
                    <div class="modal-body text-center pb-2">
                        <p class="mb-0">Please log in to continue</p>
                    </div>
                    <div class="modal-footer border-0 justify-content-center pb-4">
                        <a th:href="@{/login}" class="btn btn-dark px-5" style="border-radius: 8px;">Log In</a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Scripts -->
        <script th:src="@{/js/cart.js}"></script>
        <script th:src="@{/js/category.js}"></script>
    </div>
</body>

</html>