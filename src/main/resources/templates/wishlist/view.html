<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    xmlns:sec="http://www.thymeleaf.org/extras/spring-security" layout:decorate="~{layouts/main}">

<head>
    <title>MINARI | Wishlist</title>
    <!-- Add CSRF token for JS -->
    <meta name="csrf-token" th:content="${_csrf.token}" />

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" th:href="@{/css/whislist.css}">
    <!-- Navbar CSS handled by layout -->
</head>

<body>
    <div layout:fragment="content" class="py-5" style="margin-top: 60px;">
        <!-- Shared Title -->
        <div class="container mb-4">
            <h1 class="wish-title">Wishlist</h1>
        </div>

        <!-- Guest Gate: Shown if NOT authenticated -->
        <main id="gate" class="gate-wrap" style="display: none;">
            <div class="container">
                <div class="gate-panel mx-auto">
                    <h3 class="mb-2" style="font-weight: 600; font-size: 1.5rem; color: #333;">Your wishlist is empty
                    </h3>
                    <p class="text-muted mb-4">Log in to save your favorite items</p>
                    <div class="d-flex gap-3 justify-content-center">
                        <a th:href="@{/login}" class="btn btn-primary px-4"
                            style="background-color: #0d6efd; border-color: #0d6efd; min-width: 100px;">Log In</a>
                        <a th:href="@{/register}" class="btn btn-outline-primary px-4"
                            style="color: #0d6efd; border-color: #0d6efd; min-width: 100px;">Sign Up</a>
                    </div>
                </div>
            </div>
        </main>

        <!-- Wishlist Content: Shown if authenticated (by JS) -->
        <section id="wishContent" class="wish-wrap pt-0">
            <div class="container">
                <!-- Top meta line -->
                <div class="wish-meta">
                    <div>
                        <span id="resultCount">Results: 0 product</span>
                    </div>
                </div>

                <hr class="wish-sep">

                <!-- Wishlist items will be rendered here -->
                <div id="wishList" class="wish-list"></div>
            </div>
        </section>

        <!-- Toast -->
        <div class="toast-container position-fixed bottom-0 end-0 p-3">
            <div id="miniToast" class="toast align-items-center" data-bs-delay="1600" role="status" aria-live="polite">
                <div class="d-flex">
                    <div class="toast-body"></div>
                    <button type="button" class="btn-close me-2 m-auto" data-bs-dismiss="toast"
                        aria-label="Close"></button>
                </div>
            </div>
        </div>

        <!-- Scripts -->
        <script th:inline="javascript">
            /*<![CDATA[*/
            // Correct way to check auth in Thymeleaf 3 + Spring Security 6
            window.IS_AUTHENTICATED = /*[[${#authorization.expression('isAuthenticated()')}]]*/ false;
            /*]]>*/
        </script>
        <script th:src="@{/js/whislist.js}"></script>
    </div>
</body>

</html>