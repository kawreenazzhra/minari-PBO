<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    xmlns:sec="http://www.thymeleaf.org/extras/spring-security" layout:decorate="~{layouts/main}">

<head>
    <title>MINARI | Wishlist</title>
    <!-- Add CSRF token for JS -->
    <meta name="csrf-token" th:content="${_csrf.token}" />

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" th:href="@{/css/whislist.css}">
    <!-- Navbar CSS handled by layout -->
</head>

<body>
    <div layout:fragment="content">
        <!-- Guest Gate: Shown if NOT authenticated -->
        <!-- We can control visibility both via Thymeleaf and JS. 
             Reference uses JS to flip display:none. We'll stick to that to match reference behavior exactly. -->
        <main id="gate" class="gate-wrap" style="display: none;">
            <div class="container">
                <div class="gate-panel mx-auto">
                    <h1 class="gate-title">
                        You haven't logged in yet<br>
                        Please log in to continue
                    </h1>
                    <a id="loginBtn" class="gate-btn" th:href="@{/login}">Log in</a>
                </div>
            </div>
        </main>

        <!-- Wishlist Content: Shown if authenticated (by JS) -->
        <section id="wishContent" class="wish-wrap">
            <div class="container">
                <!-- Title -->
                <h1 class="wish-title">Wishlist</h1>

                <!-- Top meta line -->
                <div class="wish-meta">
                    <div>
                        <span id="resultCount">Results: 0 product</span>
                    </div>
                </div>

                <hr class="wish-sep">

                <!-- Wishlist items will be rendered here -->
                <div id="wishList" class="wish-list"></div>
            </div>
        </section>

        <!-- Toast -->
        <div class="toast-container position-fixed bottom-0 end-0 p-3">
            <div id="miniToast" class="toast align-items-center" data-bs-delay="1600" role="status" aria-live="polite">
                <div class="d-flex">
                    <div class="toast-body"></div>
                    <button type="button" class="btn-close me-2 m-auto" data-bs-dismiss="toast"
                        aria-label="Close"></button>
                </div>
            </div>
        </div>

        <!-- Scripts -->
        <script th:inline="javascript">
            /*<![CDATA[*/
            // Correct way to check auth in Thymeleaf 3 + Spring Security 6
            window.IS_AUTHENTICATED = /*[[${#authorization.expression('isAuthenticated()')}]]*/ false;
            /*]]>*/
        </script>
        <script th:src="@{/js/whislist.js}"></script>
    </div>
</body>

</html>